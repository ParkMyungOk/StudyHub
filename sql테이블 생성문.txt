접속정보
id : studyhub
pwd : 1234

--ADMIN_TBL
CREATE TABLE "STUDYHUB"."ADMIN_TBL" 
   (	"ANO" NUMBER(10,0), 
	"ADMINID" VARCHAR2(50 BYTE), 
	"ADMINPW" VARCHAR2(100 BYTE), 
	"ANAME" VARCHAR2(30 BYTE), 
	"EMAIL" VARCHAR2(100 BYTE), 
	"REGDATE" DATE DEFAULT sysdate, 
	 PRIMARY KEY ("ANO")
  USING INDEX PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1 BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "USERS"  ENABLE
   ) SEGMENT CREATION IMMEDIATE 
  PCTFREE 10 PCTUSED 40 INITRANS 1 MAXTRANS 255 NOCOMPRESS LOGGING
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1 BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "USERS" ;


--ATTACH_TBL
CREATE TABLE "STUDYHUB"."ATTACH_TBL" 
   (	"UUID" VARCHAR2(100 BYTE) NOT NULL ENABLE, 
	"UPLOADPATH" VARCHAR2(200 BYTE) NOT NULL ENABLE, 
	"FILENAME" VARCHAR2(100 BYTE) NOT NULL ENABLE, 
	"FILETYPE" CHAR(1 BYTE) DEFAULT 'I', 
	"UIDKEY" VARCHAR2(70 BYTE), 
	 CONSTRAINT "PK_ATTACH" PRIMARY KEY ("UUID")
  USING INDEX PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1 BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "USERS"  ENABLE, 
	 CONSTRAINT "FK_USER_ATTACH" FOREIGN KEY ("UIDKEY")
	  REFERENCES "STUDYHUB"."USER_TBL" ("UIDKEY") ON DELETE CASCADE ENABLE
   ) SEGMENT CREATION IMMEDIATE 
  PCTFREE 10 PCTUSED 40 INITRANS 1 MAXTRANS 255 NOCOMPRESS LOGGING
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1 BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "USERS" ;


--BOARD_TBL
  CREATE TABLE "STUDYHUB"."BOARD_TBL" 
   (	"BNO" NUMBER(10,0), 
	"MEET" VARCHAR2(30 BYTE) NOT NULL ENABLE, 
	"MEMBERNUM" VARCHAR2(20 BYTE), 
	"CONTACT" VARCHAR2(30 BYTE) NOT NULL ENABLE, 
	"PERIOD" VARCHAR2(20 BYTE), 
	"TITLE" VARCHAR2(200 BYTE) NOT NULL ENABLE, 
	"UIDKEY" VARCHAR2(70 BYTE), 
	"CONTENT" VARCHAR2(4000 BYTE), 
	"CNT" NUMBER(10,0), 
	"REGDATE" DATE DEFAULT sysdate, 
	"DEADLINE" VARCHAR2(40 BYTE) DEFAULT NULL, 
	"REPLYCNT" NUMBER(10,0) DEFAULT 0, 
	"CONTACTADDRESS" VARCHAR2(500 BYTE), 
	"STATUS" VARCHAR2(10 BYTE) DEFAULT 'opened' NOT NULL ENABLE, 
	 CONSTRAINT "PK_BOARD" PRIMARY KEY ("BNO")
  USING INDEX PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1 BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "USERS"  ENABLE, 
	 CONSTRAINT "FK_USER_UIDKEY" FOREIGN KEY ("UIDKEY")
	  REFERENCES "STUDYHUB"."USER_TBL" ("UIDKEY") ON DELETE CASCADE ENABLE
   ) SEGMENT CREATION IMMEDIATE 
  PCTFREE 10 PCTUSED 40 INITRANS 1 MAXTRANS 255 NOCOMPRESS LOGGING
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1 BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "USERS" ;


--BOARDFILED_TBL
CREATE TABLE "STUDYHUB"."BOARDFIELD_TBL" 
   (	"BNO" NUMBER(10,0), 
	"FNO" NUMBER(10,0), 
	 CONSTRAINT "FK_BF" FOREIGN KEY ("BNO")
	  REFERENCES "STUDYHUB"."BOARD_TBL" ("BNO") ON DELETE CASCADE ENABLE, 
	 CONSTRAINT "FK_BF_F" FOREIGN KEY ("FNO")
	  REFERENCES "STUDYHUB"."FIELD_TBL" ("FNO") ON DELETE CASCADE ENABLE
   ) SEGMENT CREATION IMMEDIATE 
  PCTFREE 10 PCTUSED 40 INITRANS 1 MAXTRANS 255 NOCOMPRESS LOGGING
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1 BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "USERS" ;


--BOARDSTACK_TBL
CREATE TABLE "STUDYHUB"."BOARDSTACK_TBL" 
   (	"BNO" NUMBER(10,0), 
	"SNO" NUMBER(10,0), 
	 CONSTRAINT "FK_BOARD_NUM" FOREIGN KEY ("BNO")
	  REFERENCES "STUDYHUB"."BOARD_TBL" ("BNO") ON DELETE CASCADE ENABLE, 
	 CONSTRAINT "FK_BOARD_STACK" FOREIGN KEY ("SNO")
	  REFERENCES "STUDYHUB"."STACK_TBL" ("SNO") ON DELETE CASCADE ENABLE
   ) SEGMENT CREATION IMMEDIATE 
  PCTFREE 10 PCTUSED 40 INITRANS 1 MAXTRANS 255 NOCOMPRESS LOGGING
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1 BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "USERS" ;


--FILED_TBL
CREATE TABLE "STUDYHUB"."FIELD_TBL" 
   (	"FNO" NUMBER(10,0), 
	"FNAME" VARCHAR2(50 BYTE), 
	 CONSTRAINT "PK_FIELD" PRIMARY KEY ("FNO")
  USING INDEX PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1 BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "USERS"  ENABLE
   ) SEGMENT CREATION IMMEDIATE 
  PCTFREE 10 PCTUSED 40 INITRANS 1 MAXTRANS 255 NOCOMPRESS LOGGING
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1 BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "USERS" ;


--INTEREST_TBL
CREATE TABLE "STUDYHUB"."INTEREST_TBL" 
   (	"UIDKEY" VARCHAR2(70 BYTE), 
	"BNO" NUMBER(10,0), 
	 CONSTRAINT "FK_I_BNO" FOREIGN KEY ("BNO")
	  REFERENCES "STUDYHUB"."BOARD_TBL" ("BNO") ON DELETE CASCADE ENABLE, 
	 CONSTRAINT "FK_I_UIDKEY" FOREIGN KEY ("UIDKEY")
	  REFERENCES "STUDYHUB"."USER_TBL" ("UIDKEY") ON DELETE CASCADE ENABLE
   ) SEGMENT CREATION IMMEDIATE 
  PCTFREE 10 PCTUSED 40 INITRANS 1 MAXTRANS 255 NOCOMPRESS LOGGING
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1 BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "USERS" ;


--REPLY_TBL
CREATE TABLE "STUDYHUB"."REPLY_TBL" 
   (	"RNO" NUMBER(10,0), 
	"BNO" NUMBER(10,0) NOT NULL ENABLE, 
	"REPLY" VARCHAR2(1000 BYTE) NOT NULL ENABLE, 
	"REPLYER" VARCHAR2(70 BYTE) NOT NULL ENABLE, 
	"REPLYDATE" DATE DEFAULT sysdate, 
	"UPDATEDATE" DATE DEFAULT sysdate, 
	"REPLYCNT" NUMBER DEFAULT 0, 
	"UIDKEY" VARCHAR2(70 BYTE), 
	 CONSTRAINT "PK_REPLY" PRIMARY KEY ("RNO")
  USING INDEX PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1 BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "USERS"  ENABLE, 
	 CONSTRAINT "FK_REPLY_BOARD" FOREIGN KEY ("BNO")
	  REFERENCES "STUDYHUB"."BOARD_TBL" ("BNO") ON DELETE CASCADE ENABLE, 
	 CONSTRAINT "FK_REPLY_USER" FOREIGN KEY ("UIDKEY")
	  REFERENCES "STUDYHUB"."USER_TBL" ("UIDKEY") ENABLE
   ) SEGMENT CREATION IMMEDIATE 
  PCTFREE 10 PCTUSED 40 INITRANS 1 MAXTRANS 255 NOCOMPRESS LOGGING
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1 BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "USERS" ;

  CREATE INDEX "STUDYHUB"."IDX_REPLY" ON "STUDYHUB"."REPLY_TBL" ("BNO" DESC, "RNO") 
  PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1 BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "USERS" ;


--STACK_TBL
CREATE TABLE "STUDYHUB"."STACK_TBL" 
   (	"SNO" NUMBER(10,0), 
	"SNAME" VARCHAR2(50 BYTE), 
	"ICON" VARCHAR2(255 BYTE), 
	"DEPT" VARCHAR2(20 BYTE), 
	 PRIMARY KEY ("SNO")
  USING INDEX PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1 BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "USERS"  ENABLE
   ) SEGMENT CREATION IMMEDIATE 
  PCTFREE 10 PCTUSED 40 INITRANS 1 MAXTRANS 255 NOCOMPRESS LOGGING
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1 BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "USERS" ;


--USER_TBL
CREATE TABLE "STUDYHUB"."USER_TBL" 
   (	"UIDKEY" VARCHAR2(70 BYTE), 
	"USNSTYPE" VARCHAR2(10 BYTE), 
	"UNICKNAME" VARCHAR2(30 BYTE), 
	"REGDATE" DATE DEFAULT sysdate, 
	"USERPW" VARCHAR2(100 BYTE), 
	"UEMAIL" VARCHAR2(100 BYTE), 
	 PRIMARY KEY ("UIDKEY")
  USING INDEX PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1 BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "USERS"  ENABLE
   ) SEGMENT CREATION IMMEDIATE 
  PCTFREE 10 PCTUSED 40 INITRANS 1 MAXTRANS 255 NOCOMPRESS LOGGING
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1 BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "USERS" ;


--USERREAD_TBL
CREATE TABLE "STUDYHUB"."USERREAD_TBL" 
   (	"URNO" NUMBER(10,0), 
	"UIDKEY" VARCHAR2(255 BYTE), 
	"BNO" NUMBER(10,0), 
	"READTIME" TIMESTAMP (6) DEFAULT SYSTIMESTAMP
   ) SEGMENT CREATION IMMEDIATE 
  PCTFREE 10 PCTUSED 40 INITRANS 1 MAXTRANS 255 NOCOMPRESS LOGGING
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1 BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "USERS" ;


--USERSTACK_TBL
CREATE TABLE "STUDYHUB"."USERSTACK_TBL" 
   (	"UIDKEY" VARCHAR2(70 BYTE), 
	"SNO" NUMBER(10,0), 
	 CONSTRAINT "FK_USER_USERSTACK" FOREIGN KEY ("UIDKEY")
	  REFERENCES "STUDYHUB"."USER_TBL" ("UIDKEY") ON DELETE CASCADE ENABLE, 
	 CONSTRAINT "FK_SNO_USERSTACK" FOREIGN KEY ("SNO")
	  REFERENCES "STUDYHUB"."STACK_TBL" ("SNO") ON DELETE CASCADE ENABLE
   ) SEGMENT CREATION IMMEDIATE 
  PCTFREE 10 PCTUSED 40 INITRANS 1 MAXTRANS 255 NOCOMPRESS LOGGING
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1 BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "USERS" ;


--BOARD_VIEW
CREATE OR REPLACE FORCE VIEW "STUDYHUB"."BOARD_VIEW" ("RN", "BNO", "UIDKEY", "REGDATE", "DEADLINE", "TITLE", "CONTENT", "STATUS", "UNAME", "PROFILEIMAGE", "FNAMES", "SNAMES", "CNT", "REPLYCNT") AS 
  SELECT  /*+INDEX_DESC(board_tbl pk_board) */
        rownum rn, b.bno, b.uidkey, b.regdate, b.deadline, b.title, b.content, b.status, u.unickname AS uname,
       NVL(a.uploadPath, 'profileLogo.png') AS profileImage,
       (
        SELECT LISTAGG(f.fname, ',') WITHIN GROUP (ORDER BY f.fname) AS combined_fname
        FROM boardfield_tbl bf
        JOIN field_tbl f ON bf.fno = f.fno
        WHERE bf.bno = b.bno
      	) AS fnames,
       (
        SELECT LISTAGG(s.sname, ',') WITHIN GROUP (ORDER BY s.sname) AS combined_sname
        FROM boardstack_tbl bs
        JOIN stack_tbl s ON bs.sno = s.sno
        WHERE bs.bno = b.bno
       ) AS snames, cnt, replycnt
FROM (
    SELECT bno, regdate, deadline, content, title, uidkey, cnt, replycnt, status
    FROM board_tbl
    ORDER BY bno desc
) b
JOIN user_tbl u
ON b.uidkey = u.uidkey
LEFT JOIN attach_tbl a
ON u.uidkey = a.uidkey;

--GET_VIEW
CREATE OR REPLACE FORCE VIEW "STUDYHUB"."BOARD_VIEW_01" ("RN", "CONTACTADDRESS", "BNO", "UIDKEY", "DEADLINE", "TITLE", "MEMBERNUM", "MEET", "PERIOD", "CONTACT", "CONTENT", "REGDATE", "STATUS", "UNAME", "PROFILEIMAGE", "FNAMES", "SNAMES", "CNT", "REPLYCNT") AS 
  SELECT /*+INDEX_DESC(board_tbl pk_board) */
    rownum rn,
    b.contactaddress,
    b.bno,
    b.uidkey,
    b.deadline,
    b.title,
    b.memberNum,
    b.meet,
    b.period,
    b.contact,
    b.content,
    b.regdate,
    b.status,
    u.unickname AS uname,
    NVL(a.uploadPath, 'profileLogo.png') AS profileImage,
    (
        SELECT LISTAGG(f.fname, ',') WITHIN GROUP (ORDER BY f.fname) AS combined_fname
        FROM boardfield_tbl bf
        JOIN field_tbl f ON bf.fno = f.fno
        WHERE bf.bno = b.bno
    ) AS fnames,
    (
        SELECT LISTAGG(s.sname, ',') WITHIN GROUP (ORDER BY s.sname) AS combined_sname
        FROM boardstack_tbl bs
        JOIN stack_tbl s ON bs.sno = s.sno
        WHERE bs.bno = b.bno
    ) AS snames,
    cnt,
    replycnt
FROM (
    SELECT *
    FROM board_tbl
    ORDER BY bno desc
) b
JOIN user_tbl u
    ON b.uidkey = u.uidkey
LEFT JOIN attach_tbl a
    ON u.uidkey = a.uidkey;